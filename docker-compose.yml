version: '3.8'

services:
  # 1. DATABASE (SQL Server)
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: warehouse_db
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=Password123!@#
    ports:
      - "1433:1433"
    volumes:
      - sql_data:/var/opt/mssql
      - ./data.sql:/docker-entrypoint-initdb.d/init.sql

  # 2. BACKEND API
  backend:
    container_name: warehouse_backend
    build:
      # ğŸ‘‡ Sá»¬A á» ÄÃ‚Y: Trá» vÃ o thÆ° má»¥c WarehousePro
      context: ./WarehousePro
      # ğŸ‘‡ Dockerfile náº±m trong thÆ° má»¥c con WarehousePro.API (tÃ­nh tá»« context á»Ÿ trÃªn)
      dockerfile: WarehousePro.API/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_HTTP_PORTS=80
      - ConnectionStrings__DefaultConnection=Server=warehouse_db;Database=WarehouseProDb;User Id=sa;Password=Password123!@#;TrustServerCertificate=True;
    ports:
      - "5000:80"
    depends_on:
      - db

  # 3. FRONTEND (ReactJS)
  frontend:
    container_name: warehouse_frontend
    build:
      # ğŸ‘‡ Äáº£m báº£o thÆ° má»¥c nÃ y Ä‘Ãºng (dá»±a theo dir cá»§a báº¡n lÃ  Ä‘Ãºng rá»“i)
      context: ./WarehouseProFE/client
      dockerfile: Dockerfile
    ports:
      - "3000:80"
    depends_on:
      - backend

volumes:
  sql_data: